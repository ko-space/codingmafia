<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>코딩 마피아 게임</title>
  <link rel="stylesheet" href="./style.css"/>
  <!-- 게임 제목 가운데 -->
  <h1 class="title">코딩 마피아 게임</h1>
</head>
<body>
  <!-- 상단 상태바 -->
  <header class="topbar">
    <div class="phase">
      <span id="phaseLabel">LOBBY</span>
      <span id="phaseTime">--s</span>
      <div class="phasebar"><div id="phaseBar"></div></div>
    </div>
    <div class="progress">
      <span>프로젝트 진행률</span>
      <div class="projbar"><div id="projBar"></div></div>
      <span id="projText">0%</span>
    </div>
  </header>

  <!-- 암전 -->
  <div id="blackout" class="blackout hidden"><div id="blackoutText" class="blackout-txt"></div></div>

  <!-- 로비(대기 모드) -->
  <section id="lobby" class="lobby-only">
    <div class="panel">
      <h2>대기 모드</h2>
      <div class="row">
        <input id="nameInput" placeholder="닉네임" />
        <button id="setNameBtn">닉네임 설정</button>
      </div>
      <div class="row">
        <input id="avatarInput" placeholder="아바타 이미지 URL(선택)" />
        <button id="setAvatarBtn">아바타 설정</button>
      </div>
      <div class="row">
        <button id="joinBtn">참여</button>
        <button id="spectateBtn">관전</button>
      </div>

      <button id="avatarToggle" class="link">▶ 아바타 선택(접기/펼치기)</button>
      <div id="avatarPanel" class="avatar-grid">
        <!-- 갤러리(요청하신 12장 + 기본) -->
        <img data-avatar src="https://mblogthumb-phinf.pstatic.net/20140606_111/sjinwon2_1402052862659ofnU1_PNG/130917_224626.png?type=w420" />
        <img data-avatar src="https://i.namu.wiki/i/hk1opVBuLjBA64wX9pGcbyW-8L99lDXDgyL-YLOOZvl_-aE3n1nRGN-oIYBoh7t7915XOu2fQxyWk9gv8hhd53D9EwclIyg3DCRP160SKr05uj-3-hVIHq13pzz_m9Kxn8xTduKXQTNS9fAAaX7oOA.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/Y4tU_Lf9vV-L820w8Uuw8yV2NWj9ZZVby-ULpqoKHeV9gKe5KNjH7tsVNN_TN_fW-GY-FjRJCYcEGwqySf0BZy9MgzppV34lIk0PQsY-1UUT_bJzrR9P3bX522chs5zujXZ2Tuh7kgiXDYgcw6zxsQ.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/PKYXMElsHDi62fTJM-7rEruQeRH-yg3f2h-el-xbcyak7WGBfYTVfod9krWiHfAXQdS9xrt3W0NaECFzABEkqF9XeZCSgknU4F-SJ2MUwLZ3Q3uoKVJrCWkpa6m4K1Z_WspFIoHkAizv9NhY1O1XhQ.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/NouUq0_qdco8xmZa17U3EhTckFtAmO1wezmubjnx4dZIvBDpt9I0o_CbdZykHGH6AAh3y9PeZfROQg9JVXVMxzHUELJv3yeHue8U00Re4EpImuwVE-eaLfbJDp552fAr7XY1u6hHwWcU9D7bf7Z0YA.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/SQy8g2B_58w4CBQnb1Kq-Iygr4X-ygCDi3ocl5rK20lcIzL52kVoyndLl8UNXceDezJgCdevsTVpL8CW02IIGOYP3bkuK6aMx3BUOrRG5lVIu4xXUZUW5rtZ7oKxwQEJLbQrHVB-GT35p1ygwx_OjA.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/KD6Ek_aT38WhP-LMOMcseeavstGUJWugtL9t5-3NtN6chdOG97Ni2R_JiD_2ArXo28nGD2pvHUzcMZ06-aAVf3-eURSVtaRKvXS8JtkiPdvQCdwfIuCNHM5LQZlmW6tTVyxSJj-y0CXXOkmfIE7Jvw.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/UDBmratqX1QWSPXwotJzf2ZzXz6f1H27F0PynbWcBKiDpuJl1uav_bl7HYXJsW4gfi4D7OZiDT_adGfH1R9-gipBcjuR6mMujtKI-wHLr-0p4euqOAinT7B8GMfNGIBTbol0LiZamulTASINsHb6_w.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/8rZ0AIVH2-XtrbBRuwKWnDDOJpeSsDAW49Aabkno-kTRNJUPSED-bCvpWJTPJAIPpYoC6CxSC1TVodRF4YwmdW-HphBoNIKn-w33QLNMmUUBFvezJMr4u0a7JIhr3oOPIl-vXysf-EkZR8dTKfjT5g.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/mjubMlATS5p48Blg6MC6AqBrCKmqhSszlpi5-Ks6YT7ul05JKI50jj56f1ZCo3yDDHlhsdEmGVXoQQhiYR2g24vBiXOpV6zDqH96ozFi8PCdhMX620AEvU32KFjS8_hN1WahWnhednJ-suxxztsN8g.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/dLlFCM7Jl8tEJXzi2NqUnehd2tYSW1ZiSoqT0WMYvGIDYGcz0rqFDCLTv42IRx5Mnmx03dSC1oHVY5LmctrNFUbJLlrpJygssmV2IItkJAhascnLyU2xPhdmisA17suWWLnGWdPvSCKW5Z4v4bcSJg.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/oXWbKionO1Fpa-lWlIiHuZhzZw4ye5Zc33FaPIdvgNZHgb28JC5EsCZsaFmwQdF9ibFck8y3DOugCw0dE_8B6E7NcTw2bLR9Wqe8a0VGmTcSpXw5kC6Br4bIBXnMd90WoVFiPRzNqFkA1xilTaG7kA.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/ads5Cvq-WnCWlOk9SpcqxbY2mH4gZREAzNYUZajZz9YI2dqrOj3hjS4PYW-rtavF3vf_Tq1OTaNKPoijwhOYWwlksaTktAnFUFM_4IcUtdI4w0_VJKqwtbN5CDBTmvIZ2gp5mcFR_-_XrK4nc5TPGA.webp"/>
        <img data-avatar src="https://i.namu.wiki/i/bXMt9kYSsYnqamgFcBxFjlsBQrCWq7r9lqbNWiMNfTreBYAhMSOQxn81DH4PNa30mWOwddsgbkyuHFqBDBsvivCb9fDhT96iuOHNnGUlnLU4ugyPter65annej50lIkcS2nJKTnuMx4MjjDD7FVOZg.webp"/>
      </div>
    </div>

    <div class="panel">
      <h3>플레이어</h3>
      <ul id="playerList" class="players"></ul>
      <button id="claimHostBtn" class="ghost">호스트 되기</button>
    </div>
  </section>

  <!-- 메인 레이아웃 -->
  <main class="grid">
    <!-- 중앙: 코딩 미션 -->
    <section id="missionCard" class="card">
      <h2>코딩 미션</h2>
      <button id="reqTaskBtn" class="primary">문제 받기</button>
      <div class="task">
        <div id="taskPrompt" class="task-prompt">문제를 받아보세요.</div>
        <div id="taskChoices" class="task-choices"></div>
      </div>
      <div id="meetingArea" class="hidden">
        <h3>회의/투표</h3>
        <select id="voteTarget"></select>
        <button id="voteBtn">투표</button>
      </div>
    </section>

    <!-- 우측: 채팅 -->
    <aside id="chatCard" class="card">
      <h2>대화</h2>
      <div id="chatLog" class="chatlog"></div>
      <div class="row">
        <input id="chatInput" placeholder="메시지 입력" />
        <button id="chatSend">보내기</button>
      </div>
      <div class="meta"><span id="you">나: -</span></div>

      <!-- 밤 행동 -->
      <div id="nightActions" class="night hidden">
        <div id="nightInfo" class="night-info"></div>
        <div id="nightControls"></div>
      </div>

      <!-- 넌센스 퀴즈 -->
      <div id="quizArea" class="quiz hidden">
        <div id="quizTitle" class="quiz-title">꿈속의 넌센스</div>
        <div id="quizQ" class="quiz-q"></div>
        <div class="row">
          <input id="quizA" placeholder="정답 입력"/>
          <button id="quizSubmit">확인</button>
        </div>
        <div id="quizMsg" class="quiz-msg"></div>
      </div>
    </aside>

    <!-- 좌측: 로그 -->
    <aside class="card">
      <h2>이벤트 로그</h2>
      <ul id="logList" class="logs"></ul>

      <!-- 사보타주 -->
      <div id="sabo" class="sabo hidden">
        <div class="sabo-title">🚨 긴급 이슈</div>
        <div>남은 시간: <span id="saboTime">--</span></div>
        <div>해결 진행: <span id="saboProg">0</span> / <span id="saboNeed">3</span></div>
        <button id="saboFixBtn" class="warn">fix</button>
      </div>
    </aside>
  </main>

  <!-- Host Tools 패널(호스트 전용) -->
  <div id="hostToolsPanel" class="host-only floating">
    <div class="ttl">👑 Host Tools</div>
    <div class="row">
      <label>마피아</label><input id="mafiaCount" type="number" min="0" max="10" value="3">
    </div>
    <div class="row">
      <label>의사</label><input id="doctorCount" type="number" min="0" max="10" value="2">
    </div>
    <div class="row">
      <label>경찰</label><input id="policeCount" type="number" min="0" max="10" value="2">
    </div>
    <div class="row">
      <button id="applyRolesBtn">역할 수 적용</button>
    </div>
    <hr/>
    <div class="col">
      <button id="btnStartGame" class="primary">▶️ 게임 시작</button>
      <button id="btnEndGame" class="danger">🛑 강제 종료</button>
      <button id="btnResetLobby">↩️ 로비 복귀</button>
      <button id="revealBtn">역할 공개 토글</button>
      <button id="btnSabo" class="warn">🚨 긴급 이슈 트리거</button>
    </div>
  </div>

  <!-- 서버 URL 설정(없으면 origin 사용) -->
  <script>window.SERVER_URL = undefined;</script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="./client.js"></script>
</body>
</html>
